/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


joint.storage=joint.storage||{},joint.storage.Local={prefix:"joint.storage",insert:function(a,b,c){var d=b.id||joint.util.uuid(),e=this.loadIndex(a);e.keys.indexOf(d)===-1&&e.keys.push(d),this.setItem(this.docKey(a,d),b),this.setItem(this.indexKey(a),e),this.callback(c,null,_.extend({},b,{id:d}))},find:function(a,b,c){var d=this.loadIndex(a),e=[];if(_.isEmpty(b))_.each(d.keys,function(b){var d=this.getItem(this.docKey(a,b));d||this.callback(c,new Error("Storage incosistency. No document found for an ID "+b+" from index.")),e.push(d)},this),this.callback(c,null,e);else if(b.id){var f=this.getItem(this.docKey(a,b.id));this.callback(c,null,f?[f]:[])}else this.callback(c,null,[])},remove:function(a,b,c){var d=this.loadIndex(a);_.isEmpty(b)?(_.each(d.keys,function(b){localStorage.removeItem(this.docKey(a,b))},this),localStorage.removeItem(this.indexKey(a)),this.callback(c,null)):b.id&&(_.remove(d.keys,function(a){return a===b.id}),localStorage.removeItem(this.docKey(a,b.id)),this.setItem(this.indexKey(a),d),this.callback(c,null))},callback:function(a,b,c){a&&_.defer(function(){a(b,c)})},setItem:function(a,b){localStorage.setItem(a,JSON.stringify(b))},getItem:function(a){var b=localStorage.getItem(a);return b?JSON.parse(b):b},loadIndex:function(a){var b=this.getItem(this.indexKey(a))||{};return b.keys=b.keys||[],b},docKey:function(a,b){return this.prefix+"."+a+".docs."+b},indexKey:function(a){return this.prefix+"."+a+".index"}};