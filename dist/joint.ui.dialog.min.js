/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


joint.ui.Dialog=joint.mvc.View.extend({className:"dialog",events:{"click .bg":"action","click .btn-close":"action","click .controls button":"action","mousedown .titlebar":"onDragStart","touchstart .titlebar":"onDragStart"},options:{draggable:!1,closeButtonContent:"&times;",closeButton:!0,inlined:!1,modal:!0},init:function(){_.bindAll(this,"onDrag","onDragEnd")},render:function(){var a=$("<div/>",{"class":"bg","data-action":"close"}),b=$("<div/>",{"class":"fg"}),c=$("<div/>",{"class":"titlebar"}),d=$("<div/>",{"class":"body"}),e=$("<button/>",{"class":"btn-close","data-action":"close",html:this.options.closeButtonContent}),f=$("<div/>",{"class":"controls"});return this.$el.toggleClass("draggable",!!this.options.draggable),this.options.type&&this.$el.attr("data-type",this.options.type),this.options.inlined&&this.$el.addClass("inlined"),this.options.modal&&this.$el.addClass("modal"),this.options.width&&b.width(this.options.width),this.options.title?c.append(this.options.title):c.addClass("empty"),this.options.content&&d.append(this.options.content),this.options.buttons&&_.each(this.options.buttons.reverse(),function(a){var b=$("<button/>",{"class":"control-button",html:a.content,"data-action":a.action});a.position&&b.addClass(a.position),f.append(b)}),b.append(c,d,f),this.options.closeButton&&b.append(e),this.$el.empty().append(a,b),this},open:function(a){return this.delegateEvents(),this.on("action:close",this.close,this),$(document.body).on({"mousemove.dialog touchmove.dialog":this.onDrag,"mouseup.dialog touchend.dialog":this.onDragEnd}),$(a||document.body).append(this.render().el),this.$el.addClass("rendered"),this},close:function(){return this.remove(),this},onRemove:function(){$(document.body).off(".dialog",this.onDrag).off(".dialog",this.onDragStart)},action:function(a){var b=$(a.target).closest("[data-action]"),c=b.attr("data-action");c&&this.trigger("action:"+c)},onDragStart:function(a){this.options.draggable&&(a=joint.util.normalizeEvent(a),this._dx=a.clientX,this._dy=a.clientY,this._dragging=!0)},onDrag:function(a){if(this._dragging){a=joint.util.normalizeEvent(a);var b=this.$(".fg"),c=b.offset();b.css({top:c.top+(a.clientY-this._dy),left:c.left+(a.clientX-this._dx),margin:0}),this._dx=a.clientX,this._dy=a.clientY}},onDragEnd:function(){this._dragging=!1}});