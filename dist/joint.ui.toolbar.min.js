/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b){a.ui.Toolbar=a.mvc.View.extend({options:{},align:["left","right"],className:"toolbar",defaultGroup:"default",widgets:[],groupViews:[],init:function(){this.tools=this.options.tools||[],this.groups=this.options.groups||{}},getWidgetByName:function(a){return b.find(this.widgets,function(b){return b.options.name===a})},getWidgets:function(){return this.widgets},groupsWithItemsPairs:function(){var a={};return b.each(this.tools,function(b){var c=b.group||this.defaultGroup;a[c]=a[c]||{items:[],group:{}},a[c].items.push(b),a[c].group=this.groups[c]||{}},this),b.chain(a).pairs().sortBy(function(a){return a[1].group.index}).sortBy(function(a){return a[1].group.align||"left"}).value()},render:function(){var a=this.groupsWithItemsPairs(),c=!1;return b.each(a,function(a){var b=a[0],d=a[1],e=this.renderGroup(b,d);!c&&d.group.align&&"right"===d.group.align&&(c=!0,e.addClass("group-first")),e.appendTo(this.el)},this),this},renderGroup:function(a,d){var e=new c({name:a,align:d.group.align,items:d.items,references:this.options.references});return this.groupViews.push(e),e.on("all",b.bind(function(){this.trigger.apply(this,arguments)},this)),e.render(),this.widgets=this.widgets.concat(e.widgets),e.$el},onRemove:function(){b.invoke(this.groupViews,"off"),b.invoke(this.groupViews,"remove")}});var c=a.mvc.View.extend({className:"toolbar-group",init:function(){this.widgets=[]},onRender:function(){this.$el.attr("data-group",this.options.name),this.$el.addClass(this.options.align),this.renderItems()},renderItems:function(){b.each(this.options.items,function(a){var b=this.createWidget(a);this.$el.append(b.$el)},this)},createWidget:function(c){var d=a.ui.Widget.create(c,this.options.references);return d.on("all",b.bind(function(a){var b=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[c.name+":"+a].concat(b))},this)),this.widgets.push(d),d},onRemove:function(){b.invoke(this.widgets,"off"),b.invoke(this.widgets,"remove")}})}(joint,_),function(a,b){a.ui.Widget=a.mvc.View.extend({className:"widget",references:[],constructor:function(b,c){this.availableReferences=c||{},a.mvc.View.prototype.constructor.call(this,b)},updateAttrs:function(b){a.util.setAttributesBySelector(this.$el,b)},bindEvents:function(){},validateReferences:function(){var a=this.references||[],c=[];return b.each(a,function(a){b.isUndefined(this.availableReferences[a])&&c.push(a)},this),c},getReference:function(a){return this.availableReferences[a]},getReferences:function(){return this.availableReferences}},{create:function(c,d){var e=b.camelCase(b.isString(c)?c:c.type);if(!b.isFunction(a.ui.widgets[e]))throw new Error('Widget: unable to find widget: "'+e+'"');var f=new a.ui.widgets[e](c,d),g=f.validateReferences(d);if(g.length>0)throw new Error('Widget: "'+e+'" missing dependency: '+g.join(", "));return f.render(),f.updateAttrs(c.attrs),f.bindEvents(),f.$el.attr("data-type",e),c.name&&f.$el.attr("data-name",c.name),f}}),a.ui.widgets={checkbox:a.ui.Widget.extend({tagName:"label",events:{"change .input":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},init:function(){b.bindAll(this,"pointerup")},render:function(){var a=this.options,b=$("<span/>").text(a.label||"");return this.$input=$("<input/>",{type:"checkbox","class":"input"}).prop("checked",!!a.value),this.$span=$("<span/>"),this.$el.append([b,this.$input,this.$span]),this},onChange:function(a){this.trigger("change",!!a.target.checked,a)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-in-action"),this.trigger("pointerdown",b),$(document).on("mouseup.checkbox touchend.checkbox",this.pointerup)},pointerup:function(b){b=a.util.normalizeEvent(b),$(document).off("mouseup.checkbox touchend.checkbox"),this.trigger("pointerdown",b),this.$el.removeClass("is-in-action")}}),toggle:a.ui.Widget.extend({tagName:"label",events:{"change input.toggle":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},init:function(){b.bindAll(this,"pointerup")},render:function(){var a=this.options,b=$("<span/>").text(a.label||""),c=$("<span><i/></span>"),d=$("<input/>",{type:"checkbox","class":"toggle"}).prop("checked",!!a.value),e=$("<div/>").addClass(a.type);return this.$el.append([b,e.append(d,c)]),this},onChange:function(a){this.trigger("change",!!a.target.checked,a)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-in-action"),this.trigger("pointerdown",b),$(document).on("mouseup.toggle touchend.toggle",this.pointerup)},pointerup:function(b){b=a.util.normalizeEvent(b),$(document).off("mouseup.toggle touchend.toggle"),this.$el.removeClass("is-in-action"),this.trigger("pointerup",b)}}),separator:a.ui.Widget.extend({render:function(){return this.options.width&&this.$el.css({width:this.options.width}),this}}),label:a.ui.Widget.extend({tagName:"label",render:function(){return this.$el.text(this.options.text),this}}),range:a.ui.Widget.extend({events:{"change .input":"onChange","input .input":"onChange"},render:function(){var a,b=this.options;return this.$output=$("<output/>").text(b.value),a=$("<span/>").addClass("units").text(b.unit),this.$input=$("<input/>",{type:"range",name:b.type,min:b.min,max:b.max,step:b.step,"class":"input"}).val(b.value),this.$el.append([this.$input,this.$output,a]),this},onChange:function(a){var b=parseInt(this.$input.val(),10);b!==this.currentValue&&(this.currentValue=b,this.$output.text(b),this.trigger("change",b,a))},setValue:function(a){this.$input.val(a),this.$input.trigger("change")}}),selectBox:a.ui.Widget.extend({render:function(){var c=b.omit(this.options,"type","group","index");return this.selectBox=new a.ui.SelectBox(c),this.selectBox.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectBox.on("all",this.trigger,this)}}),button:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",click:"pointerclick",touchend:"pointerclick"},tagName:"button",render:function(){var a=this.options;return this.$el.text(a.text),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b)}}),inputText:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=$("<label/>").text(a.label),this.$input=$("<div/>").addClass("input-wrapper").append($("<input/>",{type:"text","class":"input"}).val(a.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b)},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b)},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),inputNumber:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=$("<label/>").text(a.label),this.$input=$("<div/>").addClass("input-wrapper").append($("<input/>",{type:"number","class":"number",max:a.max,min:a.min}).val(a.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b)},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b)},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),textarea:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=$("<label/>").text(a.label),this.$input=$("<div/>").addClass("input-wrapper").append($("<textarea/>",{"class":"textarea"}).text(a.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b)},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b)},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),selectButtonGroup:a.ui.Widget.extend({render:function(){var c=b.omit(this.options,"type","group","index");return this.selectButtonGroup=new a.ui.SelectButtonGroup(c),this.selectButtonGroup.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectButtonGroup.on("all",this.trigger,this)}})},a.ui.widgets.zoomIn=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoom(c.step,{max:c.max,grid:c.step}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomOut=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoom(-c.step,{min:c.min,grid:c.step}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomToFit=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoomToFit({padding:20,scaleGrid:c.step,minScale:c.min,maxScale:c.max}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomSlider=a.ui.widgets.range.extend({references:["paperScroller"],options:{min:20,max:500,step:20,value:100,unit:" %"},bindEvents:function(){this.on("change",function(a){this.getReferences().paperScroller.zoom(a/100,{absolute:!0,grid:this.options.step/100})},this),this.getReferences().paperScroller.options.paper.on("scale",function(a){this.setValue(Math.floor(100*a))},this)}}),a.ui.widgets.undo=a.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.undo()}}),a.ui.widgets.redo=a.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.redo()}})}(joint,_);