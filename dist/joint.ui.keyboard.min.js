/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b,c){"use strict";var d=function(){c.bindAll(this,"handleKey"),this.parser=new e,this.enable()};c.extend(d.prototype,b.Events),d.prototype.on=function(a,c,d){return b.Events.on.call(this,this.normalizeEvent(a),c,d),this},d.prototype.off=function(a,c,d){var e=a?this.normalizeEvent(a):null;return b.Events.off.call(this,e,c,d),this},d.prototype.normalizeEvent=function(a){return"object"==typeof a?c.transform(a,function(a,b,c){a[this.normalizeShortcut(c)]=b},null,this):this.normalizeShortcut(a)},d.prototype.normalizeShortcut=function(a){if("all"===a.toLowerCase())return a;for(var b=this.parser.toEventObjectList(a),c=[],d=0;d<b.length;d++)c.push(this.hash(b[d]));return c.join(" ")},d.prototype.enable=function(){window.addEventListener?(document.addEventListener("keydown",this.handleKey,!1),document.addEventListener("keypress",this.handleKey,!1),document.addEventListener("keyup",this.handleKey,!1)):window.attachEvent&&(document.attachEvent("keydown",this.handleKey,!1),document.attachEvent("keypress",this.handleKey,!1),document.attachEvent("keyup",this.handleKey,!1))},d.prototype.disable=function(){window.removeEventListener?(document.removeEventListener("keydown",this.handleKey,!1),document.removeEventListener("keypress",this.handleKey,!1),document.removeEventListener("keyup",this.handleKey,!1)):window.detachEvent&&(document.detachEvent("keydown",this.handleKey,!1),document.detachEvent("keypress",this.handleKey,!1),document.detachEvent("keyup",this.handleKey,!1))},d.prototype.isActive=function(a,b){return this.isModifierActive(a,b)},d.prototype.isModifierActive=function(a,b){for(var c=this.parser.toEventObjectList(a),d=0;d<c.length;d++)if(c[d].modifiersCompare(b))return!0;return!1},d.prototype.hash=function(a){var b=function(a){return a?1:0},c=[a.type,":",a.which,b(a.shiftKey),b(a.ctrlKey),b(a.altKey),b(a.metaKey)];return c.join("")},d.prototype.handleKey=function(a){if(!this.isUnsupportedElement(a)){var c=l.fromNative(a);b.Events.trigger.call(this,this.hash(c),a)}},d.prototype.isUnsupportedElement=function(a){var b=a.target||a.srcElement;if(b){var c=b.tagName.toUpperCase();return"INPUT"===c||"SELECT"===c||"TEXTAREA"===c||b.isContentEditable}return!1};var e=function(){};e.prototype={constructor:e,parseEventString:function(a){a=a||"";var b,c,d=a.split("+"),f=new l(0);for(c=0;c<d.length;c++){b=d[c];var g=this.getModifierPropertyName(b);g&&(f[g]=!0),1!==d.length&&void 0!==g||(f.which=e.getCode(b))}return f},toEventObjectList:function(a){var b=a.replace(/\s*\+\s*/gi,"+").split(" ");return c.map(b,this.composeEventObject,this)},composeEventObject:function(a){var b=a.split(":"),c=j.KEYDOWN,d=b[0];if(b.length>1&&(d=b[1],c=b[0]),k.indexOf(c)===-1)throw a+": invalid shortcut definition";var e=this.parseEventString(d);return c===j.KEYUP&&g[e.which]&&(e[g[e.which]]=!1),e.setType(c)},getModifierPropertyName:function(a){var b=f[a];return g[b]}},e.getCode=function(a){return i[a]||a.toUpperCase().charCodeAt(0)};var f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91,meta:91},g={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},h={226:"\\",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},i={backspace:8,tab:9,shift:16,ctrl:17,alt:18,meta:91,clear:12,enter:13,"return":13,esc:27,escape:27,capslock:20,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,insert:45,ins:45,pageup:33,pagedown:34,plus:187,minus:189,"-":189,",":188,".":190,"/":191,"`":192,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},j={KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup"},k=[j.KEYPRESS,j.KEYDOWN,j.KEYUP],l=function(a,b,c,d,e,f){this.which=a,this.shiftKey=b||!1,this.ctrlKey=c||!1,this.altKey=d||!1,this.metaKey=e||!1,this.type=f||j.KEYDOWN};l.fromNative=function(a){var b=a.which;a.type===j.KEYPRESS&&(b=String.fromCharCode(a.which).toUpperCase().charCodeAt(0)),h[b]&&(b=e.getCode(h[b]));var c=new l(b,a.shiftKey,a.ctrlKey,a.altKey,a.metaKey,a.type);return a.type===j.KEYUP&&g[b]&&(c[g[b]]=!1),c},l.prototype.modifiersCompare=function(a){return!(this.shiftKey&&this.shiftKey!==a.shiftKey||this.ctrlKey&&this.ctrlKey!==a.ctrlKey||this.altKey&&this.altKey!==a.altKey||this.metaKey&&this.metaKey!==a.metaKey)},l.prototype.setType=function(a){return this.type=a,this},a.ui.Keyboard=d}(joint,Backbone,_);