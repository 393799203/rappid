/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a){"use strict";a.ui.Inspector=a.mvc.View.extend({className:"inspector",options:{cellView:void 0,cell:void 0,live:!0,validateInput:function(a,b,c){return!a.validity||a.validity.valid},renderFieldContent:void 0,operators:{},multiOpenGroups:!0,stateKey:function(a){return a.id}},events:{"change [data-attribute]:not([data-custom-field])":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",focusin:"pointerfocusin",focusout:"pointerfocusout"},HTMLEntities:{lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',cent:"¢",pound:"£",euro:"€",yen:"¥",copy:"©",reg:"®"},init:function(){this.options.groups=this.options.groups||{},_.bindAll(this,"stopBatchCommand","pointerup","onContentEditableBlur","replaceHTMLEntity"),$(document).on("mouseup",this.stopBatchCommand),this.widgets=[],this.flatAttributes=a.util.flattenObject(this.options.inputs,"/",function(a){return a.type}),this._when={},this._bound={};var b=_.map(this.flatAttributes,function(a,b){if(a.when){var c={expression:a.when,path:b};_.each(this.extractExpressionPaths(c.expression),function(a){(this._when[a]||(this._when[a]=[])).push(c)},this)}return"select"==a.type&&_.isString(a.options)&&(this._bound[b]=a.options),a.path=b,a},this);this.groupedFlatAttributes=_.sortBy(_.sortBy(b,"index"),function(a){var b=this.options.groups[a.group];return b&&b.index||Number.MAX_VALUE},this),this.on("render",function(){var a={};_.each(this.$("[data-attribute]"),function(b){var c=$(b),d=c.attr("data-attribute");a[d]=c},this),this._byPath=a,this._attributeKeysInUse=this.getAttributeKeysInUse(),_.each(this.$groups,function(a){var b=$(a),c=0===b.find("> .field:not(.hidden)").length;b.toggleClass("empty",c)})},this),this.listenTo(this.getModel(),"all",this.onCellChange,this)},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(a,b,c,d){if(d=d||{},d.inspector!=this.cid)switch(a){case"remove":this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:var e="change:";if(a.slice(0,e.length)===e){var f=a.slice(e.length);_.contains(this._attributeKeysInUse,f)&&this.render()}}},render:function(){this.$el.empty(),this.removeWidgets();var a,b,c=[];return _.each(this.groupedFlatAttributes,function(d){if(a!==d.group){var e=this.options.groups[d.group];b=this.renderGroup({name:d.group,label:e&&e.label}),e&&e.closed?this.closeGroup(b,{init:!0}):this.openGroup(b,{init:!0}),c.push(b)}this.renderTemplate(b,d,d.path),a=d.group},this),this.$groups=c,this.$el.append(c),this.trigger("render"),this},getAttributeKeysInUse:function(){var a=_.map(this._byPath,function(a,b){return b.substring(0,b.indexOf("/"))||b}),b=_.values(this._bound),c=_.keys(this._when);return _.uniq([].concat(a,b,c))},getCellAttributeValue:function(b,c){var d=this.getModel(),e=a.util.getByPath(d.attributes,b,"/");if(c=c||this.flatAttributes[b],!c)return e;if(_.isUndefined(e)&&!_.isUndefined(c.defaultValue)&&(e=c.defaultValue),c.valueRegExp){if(_.isUndefined(e))throw new Error("Inspector: defaultValue must be present when valueRegExp is used.");var f=e.match(new RegExp(c.valueRegExp));e=f&&f[2]}return e},resolveBindings:function(b){switch(b.type){case"select":var c=b.options||[];_.isString(c)&&(c=a.util.getByPath(this.getModel().attributes,c,"/")||[]),_.isObject(c[0])||(c=_.map(c,function(a){return{value:a,content:a}})),b.items=c}},updateBindings:function(a){var b=_.reduce(this._bound,function(b,c,d){return 0==a.indexOf(c)&&b.push(d),b},[]);_.isEmpty(b)||(_.each(b,function(a){this.renderTemplate(null,this.flatAttributes[a],a,{replace:!0})},this),this.trigger("render"))},renderFieldContent:function(b,c,d){var e;if(_.isFunction(this.options.renderFieldContent)&&(e=this.options.renderFieldContent(b,c,d)))return $(e).attr({"data-attribute":c,"data-type":b.type,"data-custom-field":!0});var f,g,h,i;switch(b.type){case"select-box":g=_.findIndex(b.options,function(a){return!(!_.isUndefined(a.value)||a.content!==d)||!!_.isEqual(a.value,d)});var j=_.extend({},_.omit(b,"type","group","index","selectBoxOptionsClass"),{selected:g,selectBoxOptionsClass:_.compact([a.util.addClassNamePrefix("inspector-select-box-options"),b.selectBoxOptionsClass]).join(" ")});f=new a.ui.SelectBox(j),f.$el.attr({"data-attribute":c,"data-type":b.type}),f.render(),i=$("<label/>",{html:b.label||c}),e=$("<div/>").append(i,f.el),b.previewMode?(h=f.selection,f.on("options:mouseout close",function(){f.selection=h,this.processInput(f.$el,{previewCancel:!0,dry:!0})},this),f.on("option:hover",function(a,b){f.selection=a,this.processInput(f.$el,{dry:!0})},this),f.on("option:select",function(a,b){var c=_.isUndefined(h)?void 0:f.getSelectionValue(h),d=f.getSelectionValue(a),e=c===d;this.processInput(f.$el,{previewDone:!0,dry:e,originalValue:c}),h=a},this)):f.on("option:select",function(a,b){this.processInput(f.$el)},this),this.widgets.push(f);break;case"color-palette":g=_.findIndex(b.options,function(a){return a.value===d||!(!_.isUndefined(a.value)||a.content!==d)}),f=new a.ui.ColorPalette(_.extend({},_.omit(b,"type","group","index"),{selected:g})),f.$el.attr({"data-attribute":c,"data-type":b.type}),f.render(),i=$("<label/>",{html:b.label||c}),e=$("<div/>").append(i,f.el),b.previewMode?(h=f.selection,f.on("options:mouseout close",function(){f.selection=h,this.processInput(f.$el,{previewCancel:!0,dry:!0})},this),f.on("option:hover",function(a,b){f.selection=a,this.processInput(f.$el,{dry:!0})},this),f.on("option:select",function(a,b){var c=_.isUndefined(h)?void 0:f.getSelectionValue(h),d=f.getSelectionValue(a),e=c===d;this.processInput(f.$el,{previewDone:!0,dry:e,originalValue:c}),h=a},this)):f.on("option:select",function(a,b){this.processInput(f.$el)},this),this.widgets.push(f);break;case"select-button-group":b.multi?(g=[],_.each(b.options,function(a,b){var c=_.isUndefined(a.value)?a.content:a.value,e=_.find(d,function(a){return _.isEqual(c,a)});e&&g.push(b)})):g=_.findIndex(b.options,function(a){return!!_.isEqual(a.value,d)||!(!_.isUndefined(a.value)||a.content!==d)}),f=new a.ui.SelectButtonGroup(_.extend({},_.omit(b,"type","group","index"),{selected:g})),f.$el.attr({"data-attribute":c,"data-type":b.type}),f.render(),i=$("<label/>",{html:b.label||c}),e=$("<div/>").append(i,f.el),b.previewMode?(h=f.selection,f.on("mouseout",function(){f.selection=h,this.processInput(f.$el,{previewCancel:!0,dry:!0})},this),f.on("option:hover",function(a,c){b.multi?f.selection=_.uniq(f.selection.concat([a])):f.selection=a,this.processInput(f.$el,{dry:!0})},this),f.on("option:select",function(a,b){var c=_.isUndefined(h)?void 0:f.getSelectionValue(h),d=f.getSelectionValue(a),e=_.isEqual(c,d);this.processInput(f.$el,{previewDone:!0,dry:e,originalValue:c}),h=a},this)):f.on("option:select",function(a,b){this.processInput(f.$el)},this),this.widgets.push(f);break;default:e=this.renderOwnFieldContent({options:b,type:b.type,label:b.label||c,attribute:c,value:d})}return e},renderGroup:function(a){a=a||{};var b=$("<div/>").addClass("group").attr("data-name",a.name),c=$("<h3/>").addClass("group-label").text(a.label||a.name);return b.append(c)},renderOwnFieldContent:function(a){var b,c,d,e,f,g,h,i;switch(i=$("<label/>").text(a.label),a.type){case"number":c=$("<input/>",{type:"number",min:a.options.min,max:a.options.max,step:a.options.step}).val(a.value),b=[i,$("<div/>").addClass("input-wrapper").append(c)];break;case"range":i.addClass("with-output"),e=$("<output/>").text(a.value),f=$("<span/>").addClass("units").text(a.options.unit),c=$("<input/>",{type:"range",name:a.type,min:a.options.min,max:a.options.max,step:a.options.step}).val(a.value),c.on("change input",function(){e.text(c.val())}),b=[i,e,f,c];break;case"textarea":c=$("<textarea/>").text(a.value),b=[i,$("<div/>").addClass("input-wrapper").append(c)];break;case"content-editable":var j=_.isString(a.value)?a.value.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"):"";c=$("<div/>").prop("contenteditable",!0).css("display","inline-block").html(j).on("blur",this.onContentEditableBlur),b=[i,$("<div/>").addClass("input-wrapper").append(c)];break;case"select":var k=a.options.items;c=$("<select/>"),a.options.multiple&&c.prop({size:a.options.size||k.length,multiple:!0});var l=function(b){return a.options.multiple?_.find(a.value,function(a){return _.isEqual(b,a)}):_.isEqual(b,a.value)};_.each(k,function(a){var b=$("<option/>",{value:a.value}).text(a.content);l(a.value)&&b.attr("selected","selected"),c.append(b)}),b=[i,c];break;case"toggle":g=$("<span><i/></span>"),c=$("<input/>",{type:"checkbox"}).prop("checked",!!a.value),d=$("<div/>").addClass(a.type),b=[i,d.append(c,g)];break;case"color":c=$("<input/>",{type:"color"}).val(a.value),b=[i,c];break;case"text":c=$("<input/>",{type:"text"}).val(a.value),b=[i,$("<div/>").addClass("input-wrapper").append(c)];break;case"object":c=$("<div/>"),h=$("<div/>").addClass("object-properties"),b=[i,c.append(h)];break;case"list":g=$("<button/>").addClass("btn-list-add").text(a.options.addButtonLabel||"+"),h=$("<div/>").addClass("list-items"),c=$("<div/>"),b=[i,c.append(g,h)]}return c&&c.addClass(a.type).attr({"data-type":a.type,"data-attribute":a.attribute}),$.fn.append.apply($("<div>"),b).children()},onContentEditableBlur:function(a){var b=$("<input/>",{disabled:!0,tabIndex:-1,style:{width:"1px",height:"1px",border:"none",margin:0,padding:0}}).appendTo(this.$el);b.focus(),b[0].setSelectionRange(0,0),b.blur().remove(),$(a.target).trigger("change")},replaceHTMLEntity:function(a,b){return this.HTMLEntities[b]||""},renderObjectProperty:function(a){a=a||{};var b=$("<div/>",{"data-property":a.property,"class":"object-property"});return b},renderListItem:function(a){a=a||{};var b=$("<button/>").addClass("btn-list-del").text(a.options.removeButtonLabel||"-"),c=$("<div/>",{"data-index":a.index,"class":"list-item"});return c.append(b)},renderFieldContainer:function(a){a=a||{};var b=$("<div/>",{"data-field":a.path,"class":"field "+a.type+"-field"});return b},renderTemplate:function(b,c,d,e){b=b||this.$el,e=e||{},this.resolveBindings(c);var f=this.renderFieldContainer({path:d,type:c.type});c.when&&!this.isExpressionValid(c.when)&&(f.addClass("hidden"),c.when.otherwise&&c.when.otherwise.unset&&this.unsetProperty(d));var g=this.getCellAttributeValue(d,c),h=this.renderFieldContent(c,d,g);if(f.append(h),a.util.setAttributesBySelector(f,c.attrs),"list"===c.type)_.each(g,function(a,b){var e=this.renderListItem({index:b,options:c});this.renderTemplate(e,c.item,d+"/"+b),h.children(".list-items").append(e)},this);else if("object"===c.type){c.flatAttributes=a.util.flattenObject(c.properties,"/",function(a){return a.type});var i=_.map(c.flatAttributes,function(a,b){return a.path=b,a});i=_.sortBy(i,function(a){return a.index}),_.each(i,function(a){var b=this.renderObjectProperty({property:a.path});this.renderTemplate(b,a,d+"/"+a.path),h.children(".object-properties").append(b)},this)}e.replace?b.find('[data-field="'+d+'"]').replaceWith(f):b.append(f)},updateInputPosition:function(){var a=this._byPath["position/x"],b=this._byPath["position/y"],c=this.getModel().get("position");a&&a.val(c.x),b&&b.val(c.y)},updateInputSize:function(){var a=this._byPath["size/width"],b=this._byPath["size/height"],c=this.getModel().get("size");a&&a.val(c.width),b&&b.val(c.height)},updateInputAngle:function(){var a=this._byPath.angle,b=this.getModel().get("angle");a&&a.val(b)},validateInput:function(a,b,c){switch(a){case"select-box":case"color-palette":case"select-button-group":return!0;default:return this.options.validateInput(b,c,a)}},onChangeInput:function(a){this.processInput($(a.target))},processInput:function(a,b){var c=a.attr("data-attribute"),d=a.attr("data-type");if(this.validateInput(d,a[0],c)){this.options.live&&this.updateCell(a,c,b);var e=this.getFieldValue(a[0],d),f=this.parse(d,e,a[0]);this.trigger("change:"+c,f,a[0],b)}},updateDependants:function(a){_.each(this._when[a],function(a){var b=this._byPath[a.path],c=b.closest(".field"),d=c.hasClass("hidden"),e=this.isExpressionValid(a.expression);c.toggleClass("hidden",!e),a.expression.otherwise&&a.expression.otherwise.unset&&this.options.live&&(e?d&&this.updateCell(b,a.path):(this.unsetProperty(a.path),this.renderTemplate(null,this.flatAttributes[a.path],a.path,{replace:!0}),this.trigger("render")))},this)},unsetProperty:function(b,c){var d=this.getModel(),e=b.split("/"),f=_.first(e),g=e.slice(1).join("/");if(c=c||{},c.inspector=this.cid,c["inspector_"+this.cid]=!0,"attrs"==b)d.removeAttr(g,c);else if(b==f)d.unset(f,c);else{var h=_.merge({},d.get(f)),i=a.util.unsetByPath(h,g,"/");d.set(f,i,c)}},getOptions:function(a){if(0!==a.length){var b=a.attr("data-attribute"),c=this.flatAttributes[b];if(!c){var d=a.parent().closest("[data-attribute]"),e=d.attr("data-attribute");c=this.getOptions(d);var f=b.replace(e+"/",""),g=c;c=g.item||g.flatAttributes[f],c.parent=g}return c}},updateCell:function(b,c,d){var e=this.getModel(),f={};b?f[c]=b:f=this._byPath,this.startBatchCommand();var g={},h={};_.each(f,function(b,c){if(!b.closest(".field").hasClass("hidden")){var d,f,i=b.attr("data-type");switch(i){case"list":f=this.findParentListByPath(c),f?(d=c.substr(f.length+1),a.util.setByPath(g[f],d,[],"/")):g[c]=[];break;case"object":break;default:if(!this.validateInput(i,b[0],c))return;var j=this.getFieldValue(b[0],i),k=this.parse(i,j,b[0]),l=this.getOptions(b);if(l.valueRegExp){var m=a.util.getByPath(e.attributes,c,"/")||l.defaultValue;k=m.replace(new RegExp(l.valueRegExp),"$1"+k+"$3")}if(f=this.findParentListByPath(c),f&&g[f])return d=c.substr(f.length+1),void a.util.setByPath(g[f],d,k,"/");h[c]=k}}},this),_.each(h,function(a,b){this.setProperty(b,a,d),this.updateBindings(b),this.updateDependants(b)},this),_.each(g,function(a,b){this.setProperty(b,a,_.extend({rewrite:!0},d)),this.updateBindings(b),this.updateDependants(b)},this),this.stopBatchCommand()},findParentListByPath:function(a){for(var b,c,d=a.split("/"),e=0,f=d[e],g=this.flatAttributes[f];e<d.length-1&&(!g||"list"!==g.type);)g&&"object"===g.type&&(b=g.properties),c=d[++e],f+="/"+c,g=b?b[c]:this.flatAttributes[f];return f!==a?f:null},getFieldValue:function(a,b){if(_.isFunction(this.options.getFieldValue)){var c=this.options.getFieldValue(a,b);if(c)return c.value}var d=$(a);switch(b){case"select-box":case"color-palette":case"select-button-group":var e=d.data("view");if(!e)throw new Error("ui.Inspector: can not read value of removed "+b);return e.getSelectionValue();case"content-editable":return d.html().replace(/<br(\s*)\/*>/gi,"\n").replace(/<[p|div]\s/gi,"\n$0").replace(/(<([^>]+)>)/gi,"").replace(/&(\w+);/gi,this.replaceHTMLEntity).replace(/\n$/,"");default:return d.val()}},setProperty:function(b,c,d){d=d||{},d.inspector=this.cid;var e=a.dia.Cell.prototype.prop,f=this.getModel();d.previewDone&&e.call(f,b,d.originalValue,{rewrite:!0,silent:!0}),_.isUndefined(c)?a.dia.Cell.prototype.removeProp.call(f,b,d):e.call(f,b,_.clone(c),d)},parse:function(a,b,c){switch(a){case"number":case"range":b=parseFloat(b);break;case"toggle":b=c.checked}return b},startBatchCommand:function(){this.inBatch||(this.inBatch=!0,this.getModel().startBatch("inspector",{cid:this.cid}))},stopBatchCommand:function(){this.inBatch&&(this.getModel().stopBatch("inspector",{cid:this.cid}),this.inBatch=!1)},addListItem:function(a){var b=$(a.target),c=b.closest("[data-attribute]"),d=c.attr("data-attribute"),e=this.getOptions(c),f=c.children(".list-items").children(".list-item").last(),g=0===f.length?-1:parseInt(f.attr("data-index"),10),h=g+1,i=this.renderListItem({index:h,options:e});this.renderTemplate(i,e.item,d+"/"+h),b.parent().children(".list-items").append(i),i.find("input:first").focus(),this.trigger("render"),this.options.live&&this.updateCell()},deleteListItem:function(a){var b=$(a.target).closest(".list-item");b.nextAll(".list-item").each(function(){var a=parseInt($(this).attr("data-index"),10),b=a-1;$(this).find("[data-field]").each(function(){$(this).attr("data-field",$(this).attr("data-field").replace("/"+a,"/"+b))}),$(this).find("[data-attribute]").each(function(){$(this).attr("data-attribute",$(this).attr("data-attribute").replace("/"+a,"/"+b))}),$(this).attr("data-index",b)}),b.remove(),this.trigger("render"),this.options.live&&this.updateCell()},pointerdown:function(a){this.startBatchCommand(),this._$activeField=$(a.target).closest(".field").addClass("is-in-action"),$(document).on("mouseup.inspector touchend.inspector",this.pointerup)},pointerup:function(){$(document).off(".inspector",this.pointerup),this._$activeField&&(this._$activeField.removeClass("is-in-action"),this._$activeField=null)},pointerfocusin:function(a){$(a.target).closest(".field").addClass("is-focused")},pointerfocusout:function(a){$(a.target).closest(".field").removeClass("is-focused")},onRemove:function(){this.removeWidgets(),this===this.constructor.instance&&(this.constructor.instance=null),$(document).off("mouseup",this.stopBatchCommand)},removeWidgets:function(){_.invoke(this.widgets,"remove"),this.widgets=[]},onGroupLabelClick:function(a){a.preventDefault(),this.options.multiOpenGroups||this.closeGroups();var b=$(a.target).closest(".group");this.toggleGroup(b)},toggleGroup:function(a){var b=_.isString(a)?this.$('.group[data-name="'+a+'"]'):$(a);b.hasClass("closed")?this.openGroup(b):this.closeGroup(b)},closeGroup:function(a,b){b=b||{};var c=_.isString(a)?this.$('.group[data-name="'+a+'"]'):$(a);!b.init&&c.hasClass("closed")||(c.addClass("closed"),this.trigger("group:close",c.data("name"),b))},openGroup:function(a,b){b=b||{};var c=_.isString(a)?this.$('.group[data-name="'+a+'"]'):$(a);(b.init||c.hasClass("closed"))&&(c.removeClass("closed"),this.trigger("group:open",c.data("name"),b))},closeGroups:function(){_.each(this.$groups,this.closeGroup,this)},openGroups:function(){_.each(this.$groups,this.openGroup,this)},COMPOSITE_OPERATORS:["not","and","or","nor"],PRIMITIVE_OPERATORS:["eq","ne","regex","text","lt","lte","gt","gte","in","nin","equal"],_isComposite:function(a){return _.intersection(this.COMPOSITE_OPERATORS,_.keys(a)).length>0},_isPrimitive:function(a){var b=_.keys(this.options.operators).concat(this.PRIMITIVE_OPERATORS);return _.intersection(b,_.keys(a)).length>0},_evalCustomPrimitive:function(a,b,c){return!!this.options.operators[a].apply(this,[this.getModel(),b].concat(c))},_evalPrimitive:function(a){return _.reduce(a,function(a,b,c){return _.reduce(b,function(a,b,d){var e=this.getCellAttributeValue(d);if(_.isFunction(this.options.operators[c]))return this._evalCustomPrimitive(c,e,b);switch(c){case"eq":return b==e;case"ne":return b!=e;case"regex":return new RegExp(b).test(e);case"text":return!b||_.isString(e)&&e.toLowerCase().indexOf(b)>-1;case"lt":return e<b;case"lte":return e<=b;case"gt":return e>b;case"gte":return e>=b;case"in":return _.contains(b,e);case"nin":return!_.contains(b,e);case"equal":return _.isEqual(b,e);default:return a}},!1,this)},!1,this)},_evalExpression:function(a){return this._isPrimitive(a)?this._evalPrimitive(a):_.reduce(a,function(a,b,c){if("not"==c)return!this._evalExpression(b);var d=_.map(b,this._evalExpression,this);switch(c){case"and":return _.every(d);case"or":return _.some(d);case"nor":return!_.some(d);default:return a}},!1,this)},_extractVariables:function(a){return _.isArray(a)||this._isComposite(a)?_.reduce(a,function(a,b){return a.concat(this._extractVariables(b))},[],this):_.reduce(a,function(a,b){return _.keys(b)},[])},isExpressionValid:function(a){return a=_.omit(a,"otherwise","dependencies"),this._evalExpression(a)},extractExpressionPaths:function(a){var b=a&&a.dependencies||[];return a=_.omit(a,"otherwise","dependencies"),_.uniq(this._extractVariables(a).concat(b))},getGroupsStateKey:function(){if(_.isFunction(this.options.stateKey))return this.options.stateKey(this.getModel());throw new Error("Inspector: Option stateKey must be a function")},storeGroupsState:function(){var b=this.getGroupsStateKey();a.ui.Inspector.groupStates[b]=_.map(this.$(".group.closed"),function(a){return $(a).attr("data-name")})},getGroupsState:function(){return a.ui.Inspector.groupStates[this.getGroupsStateKey()]},restoreGroupsState:function(){var b=function(a,b){_.each(b.options.groups,function(b,c){a(b,c)?this.closeGroup(c):this.openGroup(c)},b)},c=this.getGroupsStateKey();a.ui.Inspector.groupStates[c]?b(function(b,d){return _.contains(a.ui.Inspector.groupStates[c],d)},this):b(function(a){return a.closed},this)}},{groupStates:{},instance:null,create:function(a,b){b=b||{},_.defaults(b,{restoreGroupsState:!0,storeGroupsState:!0});var c=b.cell||b.cellView.model,d=this.instance;return d&&d.options.cell===c||(d&&d.el.parentNode&&(b.storeGroupsState&&d.storeGroupsState(),d.updateCell(),d.remove()),d=new this(b).render(),this.instance=d,$(a).html(d.el),b.restoreGroupsState&&d.restoreGroupsState()),d},close:function(){var a=this.instance;a&&a.remove()}})}(joint);