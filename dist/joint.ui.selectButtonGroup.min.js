/*! Rappid v2.1.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2017-09-21 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


joint.ui.SelectButtonGroup=joint.mvc.View.extend({className:"select-button-group",events:{"click .select-button-group-button":"onSelect","mouseover .select-button-group-button":"onOptionHover",mouseleave:"onMouseOut","mousedown .select-button-group-button":"pointerdown","touchstart .select-button-group-button":"pointerdown","mouseup .select-button-group-button":"pointerup","touchend .select-button-group-button":"pointerup"},options:{buttonWidth:void 0,buttonHeight:void 0,options:[],disabled:!1,multi:!1,selected:void 0},init:function(){_.bindAll(this,"onSelect","pointerup"),this.$el.data("view",this);var a=this.options.multi;_.isUndefined(this.options.selected)?this.selection=a?_.filter(this.options.options,{selected:!0}):_.findWhere(this.options.options,{selected:!0}):a?this.selection=_.isArray(this.options.selected)?_.filter(this.options.options,function(a,b){return _.contains(this.options.selected,b)},this):[this.options.options[this.options.selected]]:this.selection=this.options.options[this.options.selected]},render:function(){return this.renderOptions(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions();var a=this.options.multi;_.each(this.options.options,function(b,c){var d=a?_.contains(this.selection,b):this.selection===b,e=this.renderOption(b,c,d);this.$el.append(e),d&&e.addClass("selected")},this)},removeOptions:function(){this.$el.empty()},renderOption:function(a,b,c){var d=this.renderOptionContent(a,c);d.data("index",b);var e=a.buttonWidth||this.options.buttonWidth;e&&d.css("width",e);var f=a.buttonHeight||this.options.buttonHeight;return f&&d.css("height",f),d},renderOptionContent:function(a,b){var c=$("<div/>",{"class":"select-button-group-button",html:a.content});if(a.icon||b&&a.iconSelected){var d=$("<img/>",{"class":"select-button-group-button-icon",src:b&&a.iconSelected?a.iconSelected:a.icon}),e=a.iconWidth||this.options.iconWidth;e&&d.css("width",e);var f=a.iconHeight||this.options.iconHeight;f&&d.css("height",f),c.prepend(d)}return joint.util.setAttributesBySelector(c,a.attrs),c},getOptionIndex:function(a){return $(a).closest(".select-button-group-button").data("index")},onSelect:function(a){if(!this.isDisabled()){var b=this.getOptionIndex(a.target);this.select(b,{ui:!0})}},onOptionHover:function(a){if(!this.isDisabled()){var b=this.getOptionIndex(a.target);this.trigger("option:hover",this.options.options[b],b)}},onMouseOut:function(a){this.isDisabled()||this.trigger("mouseout",a)},getSelection:function(){return this.selection},getSelectionValue:function(a){if(a=a||this.selection)return this.options.multi?_.map(a,function(a){return _.isUndefined(a.value)?a.content:a.value}):_.isUndefined(a.value)?a.content:a.value},select:function(a,b){var c=this.options.options[a],d=$(this.$(".select-button-group-button")[a]),e=this.options.multi;if(e){d.toggleClass("selected");var f=d.hasClass("selected");f?this.selection.indexOf(c)===-1&&this.selection.push(c):this.selection=_.without(this.selection,c),c.iconSelected&&d.find(".select-button-group-button-icon").attr("src",f?c.iconSelected:c.icon)}else{this.selection=c;var g=this.$(".selected"),h=this.options.options[g.index()];g.removeClass("selected"),d.addClass("selected"),h&&h.iconSelected&&g.find(".select-button-group-button-icon").attr("src",h.icon),this.selection.iconSelected&&d.find(".select-button-group-button-icon").attr("src",this.selection.iconSelected)}this.trigger("option:select",this.selection,a,b)},selectByValue:function(a,b){_.isArray(a)||(a=[a]);for(var c=this.options.options||[],d=0;d<c.length;d++){var e=c[d];if(_.isUndefined(e.value)&&_.contains(a,e.content))this.select(d,b);else if(!_.isUndefined(e.value)){var f=_.find(a,function(a){return _.isEqual(a,e.value)});f&&this.select(d,b)}}},deselect:function(){this.$(".selected").removeClass("selected"),this.options.multi?this.selection=[]:this.selection=void 0},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},pointerdown:function(a){var b=this.getOptionIndex(a.target),c=$(this.$(".select-button-group-button")[b]);c.addClass("is-in-action"),$(document).on("mouseup.select-button-group touchend.select-button-group",this.pointerup)},pointerup:function(){this.$(".is-in-action").removeClass("is-in-action"),$(document).off("mouseup.select-button-group touchend.select-button-group")}});